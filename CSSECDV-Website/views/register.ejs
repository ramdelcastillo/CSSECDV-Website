<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register</title>
  <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
</head>

<body class="bg-gray-900 border-gray-200">
  <%- include('partials/navbar', { page: 'register' }) %>
    <div class="grid content-center grid h-56 grid-cols-3 content-start gap-4"></div>
    <form class="max-w-sm mx-auto" action="/register" method="POST" enctype="multipart/form-data">
      <a href="#" class="flex items-center justify-center mb-6 text-2xl font-semibold text-white mr-2">
        <img class="w-8 h-8 mr-2" src="https://flowbite.s3.amazonaws.com/blocks/marketing-ui/logo.svg" alt="logo">
        Flowbite
      </a>

      <div class="mb-5 flex space-x-4">

        <div class="w-1/2">
          <label for="first_name" class="block mb-2 text-sm font-medium text-white">First Name</label>
          <input type="text" id="first_name" name="first_name"
            class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 placeholder-gray-400"
             />
        </div>
        <div class="w-1/2">
          <label for="last_name" class="block mb-2 text-sm font-medium text-white">Last Name</label>
          <input type="text" id="last_name" name="last_name"
            class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 placeholder-gray-400"
             />
        </div>
      </div>
      <div class="mb-5">
        <label for="email" class="block mb-2 text-sm font-medium text-white">Your email</label>
        <input type="email" id="email" name="email"
          class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 placeholder-gray-400"
          placeholder="name@flowbite.com"  />
      </div>
      <!-- ADDED USERNAME FIELD -->
      <div class="mb-5">
        <label for="username" class="block mb-2 text-sm font-medium text-white">Your username</label>
        <input type="username" id="username" name="username"
          class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 placeholder-gray-400"
           />
      </div>
      <div class="mb-5">
        <label for="phone" class="block mb-2 text-sm font-medium text-white">Phone Number</label>
        <input type="tel" id="phone" name="phone"
          class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 placeholder-gray-400"
          placeholder="09*********"  />
      </div>
      <div class="mb-5">
        <label for="profile_image" class="block mb-2 text-sm font-medium text-white">Profile Photo (.png or .jpg
          only)</label>
        <input type="file" name="profile_image" id="profile_image"
          class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 placeholder-gray-400"
          accept="image/*" required />
      </div>
      <div class="mb-5">
        <label for="password" class="block mb-2 text-sm font-medium text-white">Your password</label>
        <input type="password" id="password" name="password"
          class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 placeholder-gray-400"
           />
      </div>
      <div class="mb-5">
        <label for="confirm-password" class="block mb-2 text-sm font-medium text-white">Retype password</label>
        <input type="password" id="confirm-password" name="confirm_password"
          class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 placeholder-gray-400"
           />
      </div>
      <button type="submit"
        class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center">Submit</button>
    </form>
    </div>
    <script>
      document.querySelector('form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        const formData = new FormData(form);

        try {
          const response = await fetch(form.action, {
            method: form.method,
            body: formData
          });

          const result = await response.json();

          if (response.ok) {
    window.location.href = '/login';
  } else {
    const message = Array.isArray(result.message) ? result.message.join("\n") : result.message;
    alert(message || "Failed to register user.");
  }
} catch (error) {
  alert("An unexpected error occurred. Please try again.");

}
      });
    </script>
</body>

</html>